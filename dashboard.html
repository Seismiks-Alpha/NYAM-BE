<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard User</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f2f2f2;
    }
    .container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    h2 {
      text-align: center;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      padding: 6px 0;
    }
    .loading {
      text-align: center;
      color: #888;
    }
    .error {
      color: red;
      text-align: center;
    }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js"

    const firebaseConfig = {
      apiKey: "AIzaSyCdiK11NWJQYMWInggskQE6w1l03Qgwjfs",
      authDomain: "seismiks-nyam.firebaseapp.com",
      projectId: "seismiks-nyam"
    }

    const app = initializeApp(firebaseConfig)
    const auth = getAuth(app)

    const infoDiv = document.getElementById("info")
    const status = document.getElementById("status")

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        status.textContent = "❌ Anda belum login. Redirecting ke login..."
        setTimeout(() => window.location.href = "register.html", 2000)
        return
      }

      try {
        const idToken = await user.getIdToken()
        const res = await fetch("http://localhost:3000/api/profile", {
  headers: {
    "Authorization": `Bearer ${idToken}`
  }
})


        const result = await res.json()

        if (result.profile) {
          infoDiv.innerHTML = `
            <h3>Data Profil Anda</h3>
            <ul>
              <li><strong>Email:</strong> ${user.email}</li>
              <li><strong>Nama:</strong> ${user.displayName ?? user.email.split('@')[0]}</li>
              <li><strong>Berat:</strong> ${result.profile.weight} kg</li>
              <li><strong>Tinggi:</strong> ${result.profile.height} cm</li>
              <li><strong>Umur:</strong> ${result.profile.age} tahun</li>
              <li><strong>Gender:</strong> ${result.profile.gender}</li>
            </ul>
          `
        } else {
          status.textContent = "❌ Profil tidak ditemukan."
        }
      } catch (err) {
        console.error(err)
        status.textContent = "❌ Gagal ambil data profil: " + err.message
      }
    })
  </script>
</head>
<body>
  <div class="container">
    <h2>Dashboard User</h2>
    <div id="info" class="loading">Memuat data...</div>
    <p id="status" class="error"></p>
  </div>
</body>
</html>
