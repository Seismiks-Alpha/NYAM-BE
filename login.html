<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Login - Firebase Auth</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js"

    const firebaseConfig = {
  apiKey: "AIzaSyCdiK11NWJQYMWInggskQE6w1l03Qgwjfs",
  authDomain: "seismiks-nyam.firebaseapp.com",
  projectId: "seismiks-nyam",
  storageBucket: "seismiks-nyam.firebasestorage.app",
  messagingSenderId: "562855494147",
  appId: "1:562855494147:web:a30ff7d67e8b09a7ed4436"
};

    const app = initializeApp(firebaseConfig)
    const auth = getAuth(app)

    async function login(event) {
      event.preventDefault()
      const email = document.getElementById("email").value
      const password = document.getElementById("password").value
      const status = document.getElementById("status")

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password)
        const idToken = await userCredential.user.getIdToken()

        // Contoh kirim ke backend
        const res = await fetch("http://localhost:3000/users/" + userCredential.user.uid + "/profile", {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${idToken}`
          },
          body: JSON.stringify({
            weight: 70,
            height: 177,
            age: 21,
            gender: "male"
          })
        })

        const result = await res.json()
        status.textContent = "Berhasil login dan update profil: " + JSON.stringify(result)
      } catch (err) {
        console.error(err)
        status.textContent = "Gagal login: " + err.message
      }
    }

    window.login = login
  </script>
</head>
<body>
  <h2>Login Firebase</h2>
  <form onsubmit="login(event)">
    <label>Email: <input type="email" id="email" required /></label><br/>
    <label>Password: <input type="password" id="password" required /></label><br/>
    <button type="submit">Login & Update Profil</button>
  </form>
  <p id="status"></p>
</body>
</html>
